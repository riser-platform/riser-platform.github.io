<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Riser Workshop v1 #  Thank you for your interest in learning and improving Riser. This Workshop is intended to be instructor led. The goal is to capture your experience with core App Deployment and debugging with Riser.
ℹ️ While this workshop is designed to be self-contained, the full Riser documentation is available to you via the links on the left. If you do wish to review the documentation, be sure to open a topic in a separate tab as to not lose your position in the Workshop."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="Riser Workshop v1 #  Thank you for your interest in learning and improving Riser. This Workshop is intended to be instructor led. The goal is to capture your experience with core App Deployment and debugging with Riser.
ℹ️ While this workshop is designed to be self-contained, the full Riser documentation is available to you via the links on the left. If you do wish to review the documentation, be sure to open a topic in a separate tab as to not lose your position in the Workshop."><meta property="og:type" content="article"><meta property="og:url" content="https://docs.riser.dev/docs/workshops/v1/"><meta property="article:modified_time" content="2020-08-17T14:34:18+02:00"><title>V1 | Riser Platform</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY="><script defer src=/en.search.min.60b9b2b80e34347bf022c95eed565e22768cc1036f08845cfbb6cb020e5d240f.js integrity="sha256-YLmyuA40NHvwIsle7VZeInaMwQNvCIRc+7bLAg5dJA8="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><img src=/logo.png alt=Logo><span>Riser Platform</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/docs/quickstart/>Quickstart</a><ul></ul></li><li><span>Concepts</span><ul><li><a href=/docs/concepts/apps/>Apps</a></li><li><a href=/docs/concepts/deployments/>Deployments</a></li><li><a href=/docs/concepts/environments/>Environments</a></li><li><a href=/docs/concepts/namespaces/>Namespaces</a></li><li><a href=/docs/concepts/secrets/>Secrets</a></li><li><a href=/docs/concepts/url_routing/>Url Routing</a></li></ul></li><li><span>Guidance</span><ul><li><a href=/docs/guidance/docker/>Docker</a></li></ul></li><li><a href=/docs/internals/>Internals</a><ul><li><a href=/docs/internals/gitops/>Gitops</a></li><li><a href=/docs/internals/secrets/>Secrets</a></li></ul></li><li><a href=/docs/operations/>Operations</a><ul></ul></li></ul><ul><li><a href=https://github.com/riser-platform/riser target=_blank rel=noopener>Github</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>V1</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#step-1---installing-the-demo>Step 1 - Installing the demo</a></li><li><a href=#step-2---creating-your-first-riser-app>Step 2 - Creating your first Riser App</a></li><li><a href=#step-3---your-first-deployment>Step 3 - Your first deployment</a></li><li><a href=#step-4---your-next-deployment>Step 4 - Your next deployment</a></li><li><a href=#step-5---configure-your-app>Step 5 - Configure your app</a></li><li><a href=#step-6---configure-secrets>Step 6 - Configure Secrets</a></li><li><a href=#step-7---rollback-deployment>Step 7 - Rollback Deployment</a></li><li><a href=#step-8---secret-revisions>Step 8 - Secret Revisions</a></li><li><a href=#step-9---canary-deployment>Step 9 - Canary Deployment</a></li><li><a href=#step-10---named-deployment>Step 10 - Named Deployment</a></li><li><a href=#final-step---take-the-survey>Final Step - Take the Survey</a></li></ul></nav></aside></header><article class=markdown><h1 id=riser-workshop-v1>Riser Workshop v1
<a class=anchor href=#riser-workshop-v1>#</a></h1><p>Thank you for your interest in learning and improving Riser. This Workshop is intended to be instructor led. The goal is to capture your experience with core App Deployment and debugging with Riser.</p><blockquote class="book-hint info">ℹ️ <em>While this workshop is designed to be self-contained, the full Riser documentation is available to you via the links on the left. If you do wish to review the documentation, be sure to open a topic in a separate tab as to not lose your position in the Workshop.</em></blockquote><h2 id=prerequisites>Prerequisites
<a class=anchor href=#prerequisites>#</a></h2><p>Prior to the workshop you should have received a set of instructions to ensure that you&rsquo;re development environment is setup to participate. Please ensure the following:</p><ul><li>Ensure that you have a recent version of the following<ul><li><a href=https://www.docker.com/get-started>Docker</a></li><li><a href=https://github.com/kubernetes/minikube>Minikube</a></li><li><a href=https://git-scm.com/downloads>Git CLI</a></li><li><a href=https://github.com/kubernetes/kubectl>Kubectl</a></li></ul></li><li>Enable the minikube ingress addon: <code>minikube addons enable ingress</code></li><li>Create a minikube cluster using Kubernetes 1.17.7. For the best results use the following settings: <code>minikube start --cpus=4 --memory=8192 --kubernetes-version=1.17.7</code>. You may need to adjust CPU and memory settings depending on your hardware.</li><li>Create a GitHub repo for Riser&rsquo;s state (e.g. <code>https://github.com/your-name/riser-state</code>).<ul><li>Riser requires write access to this repo. It is recommended that you create a <a href=https://developer.github.com/v3/guides/managing-deploy-keys/#deploy-keys>Deploy Key</a> and give it write permissions. You may also use a <a href=https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token>Personal Access Token</a>.</li></ul></li></ul><blockquote class="book-hint info">ℹ️ <em>While the Riser demo will work on any Kubernetes cluster, it is recommended for the Workshop that you use Minikube to ensure a consistent experience between participants.</em></blockquote><h2 id=step-1---installing-the-demo>Step 1 - Installing the demo
<a class=anchor href=#step-1---installing-the-demo>#</a></h2><p>The Riser demo allows you to experiment with Riser on your own Kubernetes cluster. Please use the following steps to install the demo.</p><ul><li>Ensure that minikube is started and that <code>kubectl config current-context</code> is pointing to the minikube cluster.</li><li>In a new terminal window, run <code>minikube tunnel</code>. Ensure it establishes the tunnel and let it run in the background.</li><li>Download the <a href=https://github.com/riser-platform/riser/releases/>latest Riser CLI</a> for your platform and put it in your path.</li><li>Run <code>riser demo install</code> and follow the instructions. You may skip the last step, <em>&ldquo;Try out the testdummy app&rdquo;</em>, as this is covered later in Workshop.</li><li><em>Optional</em>: If you don&rsquo;t have a local DNS server, you may wish to set an env var <code>GATEWAY_IP</code> to your gateway IP: e.g. <code>export GATEWAY_IP=10.1.2.3</code>. This will be used later for <code>curl</code> commands.</li></ul><h2 id=step-2---creating-your-first-riser-app>Step 2 - Creating your first Riser App
<a class=anchor href=#step-2---creating-your-first-riser-app>#</a></h2><p>The app that we&rsquo;re creating today will be called <strong>testdummy</strong>. Riser does not manage the building of your app nor its Docker images. For simplicity, we will be utilizing prebuilt images of a <a href=https://github.com/tshak/testdummy>preexisting testdummy</a> app.</p><ul><li>Create a directory for your app (e.g. <code>~/apps/testdummy</code>)<ul><li><code>cd</code> into the directory.</li><li>You should run all future <code>riser</code> commands from this directory.</li></ul></li><li>Create and initialize your app: <code>riser apps init testdummy</code><ul><li>Edit the TODOs in <code>app.yaml</code> where necessary</li><li>The Docker image is <code>tshak/testdummy</code>. Do not specify the docker tag.</li><li><code>testdummy</code> already listens on port 8000</li></ul></li><li>Verify that your app exists in <code>riser apps list</code></li></ul><blockquote class="book-hint info">ℹ️ <em>Riser reads the <code>app.yaml</code> in the current directory and uses information like the App&rsquo;s name and namespace so that you don&rsquo;t have to specify them every time you run the <code>riser</code> command.</em></blockquote><h2 id=step-3---your-first-deployment>Step 3 - Your first deployment
<a class=anchor href=#step-3---your-first-deployment>#</a></h2><ul><li>Check the status via <code>riser status</code></li><li>Deploy the docker tag <code>0.1.1</code> to the <code>demo</code> environment: <code>riser deploy 0.1.1 demo</code></li><li>Check the status of your deployment</li><li>Once your deployment is <strong>Ready</strong>, you can curl your URL at <code>https://testdummy.apps.demo.riser</code><ul><li>If you do not have a local DNS server, use <code>curl -k https://testdummy.apps.demo.riser --resolve "testdummy.apps.demo.riser:443:${GATEWAY_IP}"</code>, where <code>GATEWAY_IP</code> is the IP of the gateway IP assigned by the Riser demo installer. A production Riser installation would use a DNS server as well as valid SSL certificates, so the curl is usually more straightforward e.g. <code>curl https://testdummy.apps.prod.yourdomain.net</code>.<ul><li>Use <code>riser demo status</code> to display your gateway IP again if required.</li></ul></li></ul></li><li>Visit your state repo on GitHub and review the commits made by Riser<ul><li>The <code>/riser-config</code> folder contains the Riser config used to generate the state</li><li>The <code>/state/demo/riser-managed</code> folder contains all Riser managed state for the <code>demo</code> environment</li></ul></li></ul><h2 id=step-4---your-next-deployment>Step 4 - Your next deployment
<a class=anchor href=#step-4---your-next-deployment>#</a></h2><ul><li>Verify the <code>version</code> endpoint of the testdummy at <code>https://testdummy.apps.demo.riser/version</code> returns <code>0.1.1</code></li><li>Deploy the docker tag <code>0.1.2</code> to the <code>demo</code> environment</li><li>Check the status of your deployment</li><li>Once the new deployment is <strong>Ready</strong>, verify the <code>version</code> endpoint</li></ul><h2 id=step-5---configure-your-app>Step 5 - Configure your app
<a class=anchor href=#step-5---configure-your-app>#</a></h2><p>Riser loosely prescribes the <a href=https://12factor.net/>12-factor App</a> methodology. As such, all deploy-time configuration should be made as environment variables. Open <code>./app.yaml</code> and add the following environment variables:</p><pre><code>name: testdummy
# ...omitted...
env:
  MEANING: 42
  # This allows us to view all env vars at the /env endpoint
  TESTDUMMY_ENABLE_ENV: &quot;true&quot;
</code></pre><ul><li>Add the env vars as shown above</li><li>Deploy the docker tag <code>0.1.2</code> of the <code>demo</code> environment</li><li>Check the status of your deployment and note the revision number.</li><li>Visit <a href=https://testdummy.apps.demo.riser/env>https://testdummy.apps.demo.riser/env</a> to see all env vars</li></ul><blockquote class="book-hint info">ℹ️ <em>Each Riser deployment is considered unique and therefore gets a unique Revision number. This is true even if you deploy with the same docker tag or the same App config</em></blockquote><h2 id=step-6---configure-secrets>Step 6 - Configure Secrets
<a class=anchor href=#step-6---configure-secrets>#</a></h2><p>Since we do not want to store secrets in plain text, Riser provides a mechanism to encrypt your secrets for your App. Secrets encrypted at rest and bound to your App at runtime via environment variables.</p><ul><li>Save a new secret to the <code>demo</code> environment: <code>riser secrets save mysecret SuPeRSeCrEt demo</code></li><li>Your secret should be present in <code>riser secrets list demo</code></li><li>Visit your state repo on GitHub and review the recent commit made by Riser. Note that the secret has been encrypted.</li><li>While the secret has been saved, it&rsquo;s not accessible to your app until it&rsquo;s deployed. Deploy the docker tag <code>0.1.2</code> to the <code>demo</code> environment</li><li>Once the new deployment is <strong>Ready</strong>, visit Visit <a href=https://testdummy.apps.demo.riser/env>https://testdummy.apps.demo.riser/env</a>. You should see an entry for <code>MYSECRET</code></li></ul><h2 id=step-7---rollback-deployment>Step 7 - Rollback Deployment
<a class=anchor href=#step-7---rollback-deployment>#</a></h2><p>Riser allows you to route traffic to an old Revision of your Deployment. This provides a true rollback which rolls back <em>all</em> state including the docker tag, your App Config, and your secrets.</p><p>Lets say that our last step to configure secrets caused an issue with the App and we don&rsquo;t have a quick fix that we can apply and &ldquo;roll forward&rdquo;. Use the <code>riser rollout</code> command to rollback to a previous revision:</p><ul><li>Use <code>riser status --all-revisions</code> to get the previous revision number.</li><li>Use <code>riser rollout demo r${REVISION_NUMBER}:100</code> to route all traffic to the desired revision number</li><li>Check the status of your deployment. Once traffic is being routed to the previous revision, visit <a href=https://testdummy.apps.demo.riser/env>https://testdummy.apps.demo.riser/env</a> to see all env vars. You should notice that the new secret that was added in the previous step is no longer present.</li><li>Once verified, deploy tag <code>0.1.1</code> to demo again.</li><li>Once the new deployment is <strong>Ready</strong>, visit <a href=https://testdummy.apps.demo.riser/env>https://testdummy.apps.demo.riser/env</a> to see all env vars. You should notice that secret <code>MYSECRET</code> is present again. Once a secret is bound to your App in a given environment, all future deployments in that environment will contain that secret until it is changed or deleted.</li></ul><blockquote class="book-hint info">ℹ️ <em>Instead of performing a rollback, you may instead redeploy a previously deployed docker tag (e.g. deploy <code>0.1.1</code> again after deploying <code>0.1.2</code>). This creates a new revision, so changes to your <code>app.yaml</code> or secrets are still applied.</em></blockquote><h2 id=step-8---secret-revisions>Step 8 - Secret Revisions
<a class=anchor href=#step-8---secret-revisions>#</a></h2><p>Similar to deployments, each secret gets their own revision.</p><ul><li>Save a new value for <code>mysecret</code> in the <code>demo</code> environment: <code>riser secrets save mysecret NewSecretVal demo</code></li><li>Notice revision in <code>riser secrets list demo</code></li><li>Deploy the docker tag <code>0.1.1</code> to the <code>demo</code> environment</li><li>Once the new deployment is <strong>Ready</strong>, visit <a href=https://testdummy.apps.demo.riser/env>https://testdummy.apps.demo.riser/env</a> to see all env vars. The secret <code>MYSECRET</code> should now have the new value.</li><li>Perform another rollback to the previous revision.</li><li>Once the rollback is complete, visit <a href=https://testdummy.apps.demo.riser/env>https://testdummy.apps.demo.riser/env</a> to see all env vars. The secret <code>MYSECRET</code> should now have the original value.</li></ul><p>In Riser, secret revisions are automatically bound to deployment revisions. New deployments will always use the latest value of all secrets for a given environment.</p><h2 id=step-9---canary-deployment>Step 9 - Canary Deployment
<a class=anchor href=#step-9---canary-deployment>#</a></h2><p>For high availability Apps, a <a href=https://martinfowler.com/bliki/CanaryRelease.html>Canary</a> style deployment is recommended:</p><ul><li>Use <code>riser deploy 0.1.2 demo --manual-rollout</code>.</li><li>Wait until your deployment is <strong>Ready</strong> (Tip: <code>riser deploy</code> takes a <code>--wait</code> flag, useful for CI servers)</li><li>Note that even after the deployment is ready, 0% of traffic is being routed to it</li><li>You may test the new revision using the revision specific URL. For example, if the revision number is 7: <a href=https://r7-testdummy.apps.demo.riser/version>https://r7-testdummy.apps.demo.riser/version</a> (Tip: If using <code>curl</code> with the <code>--resolve</code> flag don&rsquo;t forget to change the host in both places, e.g. (<code>curl -k https://r7-testdummy.apps.demo.riser/version --resolve "r7-testdummy.apps.demo.riser:443:${GATEWAY_IP}"</code>)</li><li>Route 50% of the traffic to the canary. If the current revision number is 6 and the new one is 7: <code>riser rollout demo r6:50 r7:50</code></li><li>Check the deployment status. Once the traffic is split 50/50, check the <code>/version</code> endpoint a few times to observe the traffic being routed between the two.</li></ul><h2 id=step-10---named-deployment>Step 10 - Named Deployment
<a class=anchor href=#step-10---named-deployment>#</a></h2><p>Sometimes you&rsquo;d like to test a deployment in the same environment without affecting the existing deployment (e.g. for a pull request).</p><ul><li>Use <code>riser deploy 0.1.2 demo --name testdummy-pr-1</code></li><li>Check the deployment status</li><li>Note that a named deployment has no affect on your other deployment</li><li>You can access the named deployment at <a href=https://testdummy-pr-1.apps.demo.riser>https://testdummy-pr-1.apps.demo.riser</a></li><li>Named deployments are no different than your default deployment. Revisions, rollouts, secrets, etc. work the same.</li></ul><div class=book-expand><label><div class="book-expand-head flex justify-between"><span>Stuck?</span>
<span>↕</span></div><input type=checkbox class=hidden><div class="book-expand-content markdown-inner"><ul><li>If you don&rsquo;t have a local DNS server, don&rsquo;t forget to change both the URL and the <code>--resolve</code> flag to reflect <code>testdummy-pr-1</code>: <code>curl -k https://testdummy-pr-1.apps.demo.riser --resolve "testdummy-pr-1.apps.demo.riser:443:${GATEWAY_IP}"</code>.</li><li>Use <code>riser demo status</code> to display your gateway IP again.</li></ul></div></label></div><h2 id=final-step---take-the-survey>Final Step - Take the Survey
<a class=anchor href=#final-step---take-the-survey>#</a></h2><p>Thank you for taking the time to explore Riser and provide your feedback. It would be appreciated if you filled out this a brief survey.</p><a href=https://www.surveymonkey.com/r/TDDDSYG target=_blank class=book-btn>Take the Survey!</a></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/riserplatform/docs/commit/fbd257557bbce0239b2fc13956ff6fe4bebacdc6 title="Last modified by tshak | August 17, 2020" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>August 17, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/riserplatform/docs/edit/main//docs/workshops/v1.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#step-1---installing-the-demo>Step 1 - Installing the demo</a></li><li><a href=#step-2---creating-your-first-riser-app>Step 2 - Creating your first Riser App</a></li><li><a href=#step-3---your-first-deployment>Step 3 - Your first deployment</a></li><li><a href=#step-4---your-next-deployment>Step 4 - Your next deployment</a></li><li><a href=#step-5---configure-your-app>Step 5 - Configure your app</a></li><li><a href=#step-6---configure-secrets>Step 6 - Configure Secrets</a></li><li><a href=#step-7---rollback-deployment>Step 7 - Rollback Deployment</a></li><li><a href=#step-8---secret-revisions>Step 8 - Secret Revisions</a></li><li><a href=#step-9---canary-deployment>Step 9 - Canary Deployment</a></li><li><a href=#step-10---named-deployment>Step 10 - Named Deployment</a></li><li><a href=#final-step---take-the-survey>Final Step - Take the Survey</a></li></ul></nav></aside></main></body></html>