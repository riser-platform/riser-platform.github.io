<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="GitOps #  Riser is built on the principles of GitOps. Every change that Riser makes happens via a State Repo, a Git repository which holds a versioned account of all Kubernetes state. Whenever you issue a command in Riser (e.g. to make a Deployment), Riser makes a commit to the State Repo with the desired changes on your behalf. Each Kubernetes cluster watches for changes in the GitOps repo and applies those changes on a continuous basis.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="" />
<meta property="og:description" content="GitOps #  Riser is built on the principles of GitOps. Every change that Riser makes happens via a State Repo, a Git repository which holds a versioned account of all Kubernetes state. Whenever you issue a command in Riser (e.g. to make a Deployment), Riser makes a commit to the State Repo with the desired changes on your behalf. Each Kubernetes cluster watches for changes in the GitOps repo and applies those changes on a continuous basis." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://docs.riser.dev/docs/internals/gitops/" />
<meta property="article:modified_time" content="2020-07-29T15:20:55+02:00" />
<title>Gitops | Riser Platform</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css" integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY=">
<script defer src="/en.search.min.3b26788883aaa6da97ae44247c6d81733498c568039fe8001d4a3c38fa85e103.js" integrity="sha256-OyZ4iIOqptqXrkQkfG2BczSYxWgDn&#43;gAHUo8OPqF4QM="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/logo.png" alt="Logo" /><span>Riser Platform</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/quickstart/" class="">Quickstart</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <span>Concepts</span>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/concepts/apps/" class="">Apps</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/concepts/deployments/" class="">Deployments</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/concepts/environments/" class="">Environments</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/concepts/namespaces/" class="">Namespaces</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/concepts/secrets/" class="">Secrets</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/concepts/url_routing/" class="">Url Routing</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <span>Guidance</span>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/guidance/docker/" class="">Docker</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/internals/" class="">Internals</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/internals/gitops/" class="active">Gitops</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/internals/secrets/" class="">Secrets</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/operations/" class="">Internals</a>
  

          
  
  
  

  
  <ul>
    
  </ul>
  

        </li>
      
    
  </ul>
  











  
<ul>
  
  <li>
    <a href="https://github.com/riser-platform/riser" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Gitops</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <nav id="TableOfContents">
  <ul>
    <li><a href="#the-state-repo">The State Repo</a>
      <ul>
        <li><a href="#folder-structure">Folder Structure</a></li>
      </ul>
    </li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="gitops">
  GitOps
  <a class="anchor" href="#gitops">#</a>
</h1>
<p>Riser is built on the <a href="https://www.weave.works/technologies/gitops/">principles of GitOps</a>. Every change that Riser makes happens via a <em>State Repo</em>, a Git repository which holds a versioned account of all Kubernetes state. Whenever you issue a command in Riser (e.g. to make a <a href="/docs/concepts/deployments/">Deployment</a>), Riser makes a commit to the <em>State Repo</em> with the desired changes on your behalf. Each Kubernetes cluster watches for changes in the GitOps repo and applies those changes on a continuous basis.</p>
<blockquote class="book-hint info">
  ℹ️ <em>You do not need to interact with the State Repo as part of normal Riser operations. The State Repo is useful for auditing (e.g. who changed what and when) and for debugging (e.g. what is the current state of my Deployment)</em>
</blockquote>

<h2 id="the-state-repo">
  The State Repo
  <a class="anchor" href="#the-state-repo">#</a>
</h2>
<h3 id="folder-structure">
  Folder Structure
  <a class="anchor" href="#folder-structure">#</a>
</h3>
<p>Riser manages the folder structure of the <em>State Repo</em> for you. This section is useful to help you navigate the <em>State Repo</em> for auditing or debugging purposes, or if you wish to use the <em>State Repo</em> for Kubernetes state that is not managed by Riser.</p>
<blockquote class="book-hint warning">
  ⚠️ <em>Riser is the source of truth for all resources managed by Riser. Riser makes no attempt to merge any changes with Riser&rsquo;s desired state and the state of the repo. Do not modify any Riser managed resources in the State Repo.</em>
</blockquote>

<h4 id="annotated-example">
  Annotated Example
  <a class="anchor" href="#annotated-example">#</a>
</h4>
<p>The following is an example of a <em>State Repo</em> with two environments, &ldquo;dev&rdquo; and &ldquo;prod&rdquo;, and an <em>App</em> with a <em>Deployment</em> named &ldquo;testdummy&rdquo; in the &ldquo;apps&rdquo; namespace.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">├── riser-config <span style="color:#75715e"># &lt;- Configuration used to generate the state. This folder exists for auditing and debugging purposes</span>
│    ├── dev <span style="color:#75715e"># &lt;- The environment</span>
│    │    └── apps <span style="color:#75715e"># &lt;- The namespace</span>
│    │         └── testdummy.yaml <span style="color:#75715e"># &lt;- The App config for &#34;testdummy&#34;</span>
│    └── prod <span style="color:#75715e"># &lt;- The environment</span>
│         └── ... <span style="color:#75715e"># &lt;- Same as &#34;dev&#34; above, but with configuration for the &#34;prod&#34; environment</span>
└── state <span style="color:#75715e"># &lt;- Kubernetes state goes here</span>
     ├── dev <span style="color:#75715e"># &lt;- The environment. A Kubernetes cluster (for the &#34;dev&#34; environment) applies all resources from this folder</span>
     │    └── riser-managed <span style="color:#75715e"># &lt;- Resources that are managed by Riser.</span>
     │          ├── apps <span style="color:#75715e"># &lt;- The namespace</span>
     │          │    ├── deployments <span style="color:#75715e"># &lt;- deployment resources</span>
     │          │    │    ├── testdummy <span style="color:#75715e"># &lt;- The deployment name</span>
     │          │    │    │    └── ...*.yaml <span style="color:#75715e"># &lt;- One or more deployment resource files</span>
     │          │    └── secrets <span style="color:#75715e"># &lt;- App encrypted secrets</span>
     │          │         └── testdummy <span style="color:#75715e"># &lt;- The app name</span>
     │          │               └── ...*.yaml <span style="color:#75715e"># &lt;- One or more secret resource files</span>
     │          └── namespace.apps.yaml <span style="color:#75715e"># &lt;- The namespace ya</span>
     └── prod <span style="color:#75715e"># &lt;- The environment. A Kubernetes cluster (for the &#34;prod&#34; environment) applies all resources from this folder</span>
          └── ... <span style="color:#75715e"># &lt;- Same as &#34;dev&#34; above, but with resources for the &#34;prod&#34; environment</span>
</code></pre></div><h4 id="riser-config">
  riser-config
  <a class="anchor" href="#riser-config">#</a>
</h4>
<p>The top level <code>riser-config</code> folder is a top level folder that contains all configuration used to generate Kubernetes state for each <em>App</em>, in each <em>Environment</em>, and for each <em>Deployment</em> in that <em>Environment</em>. It contains the final configuration used with any overrides applied. This folder is only used for auditing and debugging purposes. It makes it easy to observe what changes happened in a given environment over time. It also makes it trivial to compare differences between environments. For example, the following command shows the differences between the current final state of the <code>testdummy</code> deployment between the <code>dev</code> and the <code>prod</code> environment.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">diff -c riser-config/dev/apps/testdummy.yaml riser-config/prod/apps/testdummy.yaml
</code></pre></div><p>With this approach, there is no need to do any mental gymnastics with template variables or complicated overlays to determine your <em>App&rsquo;s</em> configuration.</p>
<h4 id="state">
  state
  <a class="anchor" href="#state">#</a>
</h4>
<p>The top level <code>state</code> folder contains all resources that represent state in Kubernetes. Each <em>Environment</em> has its own sub folder which contains the resources that are continuously applied to the Kubernetes cluster. The <code>riser-managed</code> folder container resources that are strictly managed by Riser. You should treat this as a <em>readonly</em> folder. If you have non Riser resources that you would also like to manage via GitOps, you may create a sibling folder and manage those resources as you wish.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">



  <div><a class="flex align-center" href="https://github.com/riserplatform/docs/commit/609eb452c194b5341940cd0efc37ed030c4b06c0" title='Last modified by tshak | July 29, 2020' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>July 29, 2020</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/riserplatform/docs/edit/main//docs/internals/gitops.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>

</div>

 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#the-state-repo">The State Repo</a>
      <ul>
        <li><a href="#folder-structure">Folder Structure</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












